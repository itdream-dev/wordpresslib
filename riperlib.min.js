
console.log('Riper lib version: 1.0');var CONTRACT_ABI=[{"inputs":[],"stateMutability":"nonpayable","type":"constructor"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"approved","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Approval","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"owner","type":"address"},{"indexed":true,"internalType":"address","name":"operator","type":"address"},{"indexed":false,"internalType":"bool","name":"approved","type":"bool"}],"name":"ApprovalForAll","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Paused","type":"event"},{"anonymous":false,"inputs":[{"indexed":true,"internalType":"address","name":"from","type":"address"},{"indexed":true,"internalType":"address","name":"to","type":"address"},{"indexed":true,"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"Transfer","type":"event"},{"anonymous":false,"inputs":[{"indexed":false,"internalType":"address","name":"account","type":"address"}],"name":"Unpaused","type":"event"},{"inputs":[{"internalType":"address","name":"","type":"address"}],"name":"MintAmountPerPublicAddress","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"approve","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"}],"name":"balanceOf","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"chartiyWalletAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"string[]","name":"tokenURIs","type":"string[]"},{"internalType":"bool","name":"forSale","type":"bool"}],"name":"createToken","outputs":[{"internalType":"uint256[]","name":"","type":"uint256[]"}],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"getApproved","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getOwnerRoyaltyPercentFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getPrice","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"getTeamRoyaltyPercentFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"owner","type":"address"},{"internalType":"address","name":"operator","type":"address"}],"name":"isApprovedForAll","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"name","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"owner","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"ownerOf","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"ownerRoyaltyPercentFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"pause","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"paused","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"publicMaxSupply","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"publicSaleAmount","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"publicSaleLimitPerAddress","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"},{"internalType":"bytes","name":"_data","type":"bytes"}],"name":"safeTransferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"sale","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"payable","type":"function"},{"inputs":[{"internalType":"address","name":"operator","type":"address"},{"internalType":"bool","name":"approved","type":"bool"}],"name":"setApprovalForAll","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_addr","type":"address"}],"name":"setCharityWallet","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_feePercent","type":"uint256"}],"name":"setOwnerRoyaltyPercentFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newPrice","type":"uint256"}],"name":"setPrice","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newAmount","type":"uint256"}],"name":"setPublicSaleLimitPerAddress","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"newAmount","type":"uint256"}],"name":"setPublicSaleMaxSupply","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"uint256","name":"_feePercent","type":"uint256"}],"name":"setTeamRoyaltyPercentFee","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_addr","type":"address"}],"name":"setTeamWallet","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"_addr","type":"address"}],"name":"setTokenDeployer","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"bytes4","name":"interfaceId","type":"bytes4"}],"name":"supportsInterface","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"symbol","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"teamRoyaltyPercentFee","outputs":[{"internalType":"uint256","name":"","type":"uint256"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"teamWalletAddress","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[],"name":"tokenDeployer","outputs":[{"internalType":"address","name":"","type":"address"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"","type":"uint256"}],"name":"tokenIdStatus","outputs":[{"internalType":"bool","name":"","type":"bool"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"tokenURI","outputs":[{"internalType":"string","name":"","type":"string"}],"stateMutability":"view","type":"function"},{"inputs":[{"internalType":"address","name":"from","type":"address"},{"internalType":"address","name":"to","type":"address"},{"internalType":"uint256","name":"tokenId","type":"uint256"}],"name":"transferFrom","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[{"internalType":"address","name":"newOwner","type":"address"}],"name":"transferOwnerShip","outputs":[],"stateMutability":"nonpayable","type":"function"},{"inputs":[],"name":"unpause","outputs":[],"stateMutability":"nonpayable","type":"function"}];var CONTRACT_ADDRESS="0x779304bDD8f8Ad1FDF2573580d499D7C50F8730c";var currentAccount="";var price=0;var chainId=0;var status=0;var provider=null;$(document).ready(function(){$("#btn_buy_nft").hover(function(){$(this).css("cursor","pointer")});$("#btn_wallet_connect").hover(function(){$(this).css("cursor","pointer")});$('#status_span_wallet_connection').hide();$('#status_tx_message').hide();$('#btn_buy_nft').hide();$('#nft_price').hide();if(typeof window.ethereum!=='undefined'){console.log('MetaMask is installed!');provider=new ethers.providers.Web3Provider(window.ethereum)}else{$("#btn_wallet_connect").hide();$('#status_span_wallet_connection').hide();$('#status_tx_message').hide();$('#btn_buy_nft').hide();}
console.log("ready!");$("#btn_buy_nft").click(function(){console.log('clicked')
buyToken()});$('#btn_wallet_connect').click(function(){console.log('clicked connect')
if(typeof window.ethereum!=='undefined'){connect();}else{alert("Please install metamask to connect with website!");}});});async function handleAccountsChanged(accounts){console.log('Calling HandleChanged')
if(accounts.length===0){console.log('Please connect to MetaMask.');$('#btn_buy_nft').prop("disabled",true);}else if(accounts[0]!==currentAccount){currentAccount=accounts[0];$('#status').html('')
if(currentAccount!=null){$('#btn_wallet_connect').hide();$('#btn_buy_nft').prop("disabled",false);$('.status_span_wallet_connection').html(currentAccount.substr(0,10)+"...")
$('#status_span_wallet_connection').show();$('#status_tx_message').show();$('#btn_buy_nft').show();$('#nft_price').show();chainId=await ethereum.request({method:'eth_chainId'})
if(chainId!=4){$('#btn_buy_nft').prop("disabled",true);$('#btn_buy_nft').css('background-image',"linear-gradient(180deg, #79797978 0%, #605a5b 100%)");setMessage('You are on Wrong Network (Chain)!','error')
return;}
var contract=new ethers.Contract(CONTRACT_ADDRESS,CONTRACT_ABI,provider);price=await contract.getPrice();console.log('price',ethers.utils.formatEther(price));$('#nft_price').html(`Price: ${ethers.utils.formatEther(price)} ETH`);}}
console.log('WalletAddress in HandleAccountChanged ='+currentAccount)}
function handleChainChanged(_chainId){console.log('handleChainChanged',chainId)
window.location.reload();}
function setMessage(message,type){if(type=='error'){$('#status_tx_message').css('color','red');}else if(type=="success"){$('#status_tx_message').css('color','green');}
$('#status_tx_message').html(message);}
function connect(){console.log('Calling connect()')
ethereum.request({method:'eth_requestAccounts'}).then(handleAccountsChanged).catch((err)=>{if(err.code===4001){console.log('Please connect to MetaMask.');$('#status_span_wallet_connection').html('You refused to connect Metamask')}else{console.error(err);}});ethereum.on('chainChanged',handleChainChanged);ethereum.on('accountsChanged',handleAccountsChanged);}
async function checkTransaction(){tx=localStorage.getItem('tx');if(tx&&tx!=""&&provider){provider.getTransactionReceipt(tx).then(function(transactionReceipt){console.log(transactionReceipt);if(transactionReceipt!=null){status=0;localStorage.setItem('tx',"");$('#btn_buy_nft').html("Buy NFT");setMessage("")}else{status=1;setTimeout(checkTransaction,1000);}});}else if(tx&&tx!=""){setTimeout(checkTransaction,1000);}else{status=0;}}
async function buyToken(){if(!provider)return;if(currentAccount=="")return;if(price==0)return;if(chainId!=4){setMessage(`You are on wrong network!`,'error');return;}
if(status!=0)return;setMessage("");console.log('mint Token')
var signer=provider.getSigner();console.log('signer',signer);console.log('provider',provider);var contract=new ethers.Contract(CONTRACT_ADDRESS,CONTRACT_ABI,provider);try{console.log('currentAccount',currentAccount);var gasPrice=await provider.getGasPrice();console.log('gasPrice',gasPrice);var overrides={value:price,from:currentAccount,gasPrice:gasPrice,};const gas=await contract.estimateGas.sale(overrides);console.log('gas',gas);var contractSigner=contract.connect(signer);try{overrides.gasLimit=2100000;var tx=await contractSigner.sale(overrides);console.log('tx',tx);localStorage.setItem("tx",tx.hash);status=-1;setTimeout(checkTransaction,1000);setMessage(`Please check your tx <a target="_blank" href=https://rinkeby.etherscan.io/tx/${tx.hash}>here</a>.`);$('#btn_buy_nft').html("Processing Tx...");}catch(err){if(err.code==4001){setMessage(`You rejected transaction.`,'error');}
console.log('err',err);}}catch(err){console.log('balance err',err);}}
